<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games Manager V3</title>
    <style>
        :root {
            --bg-color: #121212;
            --sidebar-color: #1e1e1e;
            --accent-color: #007acc;
            --text-color: #e0e0e0;
            --text-dim: #888888;
            --border-color: #333333;
            --card-bg: #1e1e1e;
            --input-bg: #161616;
            --hover-color: #2d2d30;
            --shadow-color: rgba(0,0,0,0.5);
            --border-radius: 6px;
            --font-family: 'Segoe UI', system-ui, sans-serif;
            --transition-speed: 0.2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        * {
            transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed), box-shadow var(--transition-speed);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
            display: grid;
            grid-template-columns: auto 1fr;
            overflow: hidden;
        }

        /* --- Sidebar Navigation (Icons) --- */
        #sidebar {
            width: 60px;
            background-color: var(--sidebar-color);
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            border-right: 1px solid var(--border-color);
            z-index: 100;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        #sidebar:hover {
            width: 200px;
        }

        .nav-item {
            width: 100%;
            padding: 15px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            transition: background 0.2s;
            position: relative;
            white-space: nowrap;
        }

        .nav-item:hover { background-color: var(--hover-color); }
        .nav-item.active { background-color: var(--hover-color); border-left: 3px solid var(--accent-color); }
        
        .nav-icon { 
            width: 60px; /* Exact width of collapsed sidebar */
            min-width: 60px;
            text-align: center;
            font-size: 24px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-text {
            margin-left: 5px;
            opacity: 0;
            display: none;
            transition: opacity 0.2s;
            font-weight: 500;
            color: var(--text-color);
            pointer-events: none;
        }

        #sidebar:hover .nav-text {
            display: inline;
            opacity: 1;
        }

        .sidebar-logo-container {
            width: 100%;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        #sidebar img + #logo-placeholder { display: none; }
        #sidebar img[style*="display: none"] + #logo-placeholder { display: flex; }

        /* --- Main Layout --- */
        #main-container { flex: 1; position: relative; overflow: hidden; height: 100%; }
        #content { position: absolute; top: 0; left: 0; right: 0; bottom: 25px; overflow: hidden; display: flex; }
        .view { flex: 1; display: none; flex-direction: column; animation: fadeIn 0.2s; }
        .view.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Tree View Layout (Library) --- */
        #library-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Tree Sidebar */
        #library-tree-container {
            width: 300px;
            background-color: var(--sidebar-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        #tree-search {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        #tree-search input {
            width: 100%;
            padding: 8px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
        }

        #library-tree {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        /* Nested Categories Indentation */
        #library-tree details details {
            margin-left: 15px;
        }

        /* Tree Items */
        details { display: block; }
        summary {
            cursor: pointer;
            padding: 8px 15px;
            list-style: none; /* Hide default triangle */
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            user-select: none;
        }
        
        summary:hover { background-color: var(--hover-color); }
        summary::before {
            content: '‚ñ∂';
            font-size: 10px;
            margin-right: 8px;
            transition: transform 0.2s;
            color: var(--text-dim);
        }
        details[open] > summary::before { transform: rotate(90deg); }
        
        /* Sub-items (Games) */
        .tree-item {
            padding: 6px 15px 6px 38px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-dim);
            transition: color 0.2s, background 0.2s;
            display: block;
        }

        .tree-item.installed { color: var(--text-color); font-weight: 400; }
        .tree-item:hover { color: white; background-color: var(--hover-color); }
        .tree-item.selected { 
            color: white; 
            background-color: var(--hover-color); 
            border-left: 3px solid var(--accent-color); 
            box-shadow: inset 5px 0 10px -3px var(--accent-color);
        }
        .tree-item.uninstalled { opacity: 0.6; font-style: italic; }

        /* --- Details Panel --- */
        #details-panel {
            flex: 1;
            background-color: var(--bg-color);
            position: relative;
            overflow-y: auto;
            display: none; /* Hidden by default until selection */
        }
        
        #details-panel.active { display: block; }

        .close-btn, .settings-icon-btn {
            position: absolute;
            top: 20px;
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn { right: 20px; }
        .settings-icon-btn { right: 70px; font-size: 20px; }
        
        .close-btn:hover { background: rgba(200, 50, 50, 0.8); }
        .settings-icon-btn:hover { background: var(--accent-color); color: white; }

        .hero-image {
            width: 100%;
            height: 300px;
            background-size: cover;
            background-position: top;
            mask-image: linear-gradient(to bottom, black 50%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent);
        }

        .details-content { padding: 0 40px 40px 40px; margin-top: -60px; position: relative; }
        .game-title-large { font-size: 48px; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .game-meta { font-size: 14px; color: var(--text-dim); margin-bottom: 25px; }
        
        .actions { display: flex; gap: 15px; margin-bottom: 30px; }
        .btn { padding: 10px 30px; border: none; border-radius: var(--border-radius); font-weight: bold; cursor: pointer; font-size: 16px; }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-secondary { background-color: var(--border-color); color: var(--text-color); }
        .btn-secondary:hover { background-color: var(--hover-color); }

        .screenshots { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); 
            gap: 20px; 
            justify-content: center;
        }
        .screenshot { width: 100%; aspect-ratio: 16/9; background-color: #222; border-radius: var(--border-radius); background-size: cover; background-position: center; }

        /* Slideshow Container */
        .slideshow-container {
            position: relative; 
            width: 100%; 
            /* Removed fixed max-width to allow full stretching */
            margin: 0 auto 30px auto;
            aspect-ratio: 16/9; 
            background: #000; 
            border-radius: var(--border-radius); 
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        .slide-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 20px;
            user-select: none;
            transition: background 0.2s;
            border-radius: 4px;
        }
        .slide-arrow:hover { background: rgba(0, 0, 0, 0.8); }

        /* --- Other Views --- */
        .simple-header { padding: 20px 40px; border-bottom: 1px solid var(--border-color); box-sizing: border-box; }
        .simple-content { padding: 20px 40px; box-sizing: border-box; }
        
        /* --- Footer --- */
        #footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: 25px;
            background-color: var(--accent-color);
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            justify-content: space-between;
            box-sizing: border-box;
            z-index: 1000;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .spin { display: inline-block; animation: spin 1s linear infinite; margin-right: 5px; }

        /* Description Styling */
        #detail-description p { margin-bottom: 15px; }
        #detail-description h3, #detail-description h2 { color: var(--header-color); margin-top: 20px; margin-bottom: 10px; font-size: 1.1em; }
        #detail-description ul { padding-left: 20px; margin-bottom: 15px; }
        #detail-description li { margin-bottom: 5px; }
        #detail-description br { display: block; content: ""; margin-top: 10px; }

        /* Specs Styling */
        .spec-list { list-style: none; padding: 0; margin: 0; }
        .spec-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #333; 
            font-size: 13px;
        }
        .spec-item:last-child { border-bottom: none; }
        .spec-label { color: #888; font-weight: 600; min-width: 80px; }
        .spec-value { color: #ddd; text-align: right; margin-left: 10px; }

        /* Settings Styles */
        .settings-wrapper { 
            flex: 1;
            overflow-y: auto;
            max-width: 900px; 
            margin: 0 auto;
            box-sizing: border-box; 
            padding: 20px;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
        }
        .settings-card { 
            background-color: var(--card-bg); 
            border-radius: var(--border-radius); 
            padding: 30px; 
            margin-bottom: 25px; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .settings-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-color);
            border-color: var(--accent-color);
        }
        .settings-card h2 { 
            margin-top: 0; 
            margin-bottom: 25px; 
            font-size: 20px; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 15px; 
            color: var(--text-color); 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { 
            display: block; 
            margin-bottom: 10px; 
            color: var(--text-color); 
            font-size: 14px; 
            font-weight: 600; 
            letter-spacing: 0.5px;
        }
        .input-row { display: flex; gap: 15px; }
        .input-row input { 
            flex: 1; 
            padding: 12px 15px; 
            background-color: var(--input-bg); 
            border: 1px solid var(--border-color); 
            color: var(--text-color); 
            border-radius: var(--border-radius); 
            font-family: inherit; 
            font-size: 14px;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .input-row input:focus { 
            border-color: var(--accent-color); 
            background-color: var(--bg-color); 
            outline: none; 
        }
        .hint { 
            font-size: 13px; 
            color: var(--text-dim); 
            margin-top: 8px; 
            margin-bottom: 0; 
            line-height: 1.4;
        }
        
        .path-list { 
            list-style: none; 
            padding: 0; 
            background: var(--input-bg); 
            border-radius: var(--border-radius); 
            border: 1px solid var(--border-color); 
            margin-bottom: 15px; 
            max-height: 200px;
            overflow-y: auto;
        }
        .path-list li { 
            padding: 12px 15px; 
            border-bottom: 1px solid var(--border-color); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            color: var(--text-color); 
            font-size: 14px; 
        }
        .path-list li:last-child { border-bottom: none; }
        
        /* Button Upgrades */
        .btn {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: var(--border-radius);
            letter-spacing: 0.5px;
            transition: background 0.2s, transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        
        .btn-danger { 
            background-color: transparent; 
            color: var(--danger-color); 
            border: 1px solid var(--danger-border);
        }
        .btn-danger:hover { 
            background-color: var(--hover-color); 
            border-color: var(--danger-color); 
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { 
            opacity: 0; 
            width: 100%; 
            height: 100%; 
            position: absolute; 
            top: 0; 
            left: 0; 
            cursor: pointer; 
            z-index: 2; /* Ensure it's clickable/focusable over the slider */
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(24px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }

        /* Big Picture Card Upgrades */
        .bp-card {
            aspect-ratio: 2/3;
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s, border-color 0.3s;
            border: 4px solid transparent;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            position: relative;
        }

        .bp-card:focus {
            transform: scale(1.15);
            border-color: var(--accent-color);
            box-shadow: 0 15px 40px var(--shadow-color);
            z-index: 10;
            outline: none !important;
        }

        .bp-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #bp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            padding: 40px;
            overflow-y: auto;
            flex: 1;
            align-content: start;
        }

        #bp-selection-info {
            height: 200px;
            background: rgba(0,0,0,0.8);
            margin: 0 40px 40px 40px;
            border-radius: 16px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }

        .bp-modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .bp-modal {
            background: #1a1a1a;
            border: 2px solid var(--accent-color);
            border-radius: 24px;
            padding: 0;
            width: 800px;
            text-align: center;
            box-shadow: 0 0 100px rgba(0, 0, 0, 0.8);
            overflow: hidden;
            position: relative;
        }

        #bp-modal-banner {
            width: 100%;
            height: 250px;
            background-size: cover;
            background-position: center;
            border-bottom: 2px solid var(--accent-color);
        }

        .bp-modal-content {
            padding: 40px;
        }

        /* Focus Indicators for Controller Navigation */
        :focus {
            outline: 2px solid var(--accent-color) !important;
            outline-offset: 2px !important;
        }
        
        .btn:focus, .nav-item:focus, .tree-item:focus, summary:focus {
            outline: 2px solid #fff !important;
            outline-offset: 2px !important;
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* Remove default outline for mouse users if desired, but keep for keyboard/controller */
        :focus:not(:focus-visible) {
            outline: none !important;
        }
        
    </style>
</head>
<body>

    <nav id="sidebar">
        <div class="sidebar-logo-container">
            <img src="assets/logo.png" onerror="this.style.display='none'" style="width: 40px; height: 40px; border-radius: 8px;">
            <div id="sidebar-username" class="nav-text" style="margin-left: 10px; font-weight: bold; color: white;">Guest</div>
        </div>
        <div class="nav-item active" onclick="switchTab('library')" title="Library">
            <span class="nav-icon">üìö</span>
            <span class="nav-text" data-i18n="sidebar.library">Library <span id="badge-library" style="background: var(--accent-color); color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 5px; display: none;"></span></span>
        </div>
        <div class="nav-item" onclick="switchTab('search')" title="Store">
            <span class="nav-icon">üîç</span>
            <span class="nav-text" data-i18n="sidebar.store">Store</span>
        </div>
        <div class="nav-item" onclick="switchTab('downloads')" title="Downloads">
            <span class="nav-icon">‚¨áÔ∏è</span>
            <span class="nav-text" data-i18n="sidebar.downloads">Downloads <span id="badge-downloads" style="background: var(--accent-color); color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 5px; display: none;"></span></span>
        </div>
        <div class="nav-item" onclick="switchTab('scripts')" title="Scripts">
            <span class="nav-icon">üìú</span>
            <span class="nav-text" data-i18n="sidebar.scripts">Scripts</span>
        </div>
        <div class="nav-item" onclick="switchTab('settings')" title="Settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-text" data-i18n="sidebar.settings">Settings</span>
        </div>
        <div class="nav-item" onclick="switchTab('profile')" title="Profile">
            <span class="nav-icon">üë§</span>
            <span class="nav-text" data-i18n="sidebar.profile">Profile</span>
        </div>
        <div class="nav-item" onclick="selectRandomGame()" title="Random Game" style="margin-top: auto;">
            <span class="nav-icon">üé≤</span>
            <span class="nav-text" data-i18n="sidebar.random">Random</span>
        </div>
        <div class="nav-item" onclick="toggleBigPicture()" title="Big Picture Mode" style="margin-bottom: 20px; color: gold;">
            <span class="nav-icon">üì∫</span>
            <span class="nav-text" data-i18n="sidebar.big_picture">Big Picture</span>
        </div>
    </nav>

    <div id="main-container">
        <div id="content">
            <!-- Big Picture View -->
            <div id="view-bigpicture" class="view" style="background: linear-gradient(135deg, #000428 0%, #004e92 100%); z-index: 2000; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: none;">
                <div style="padding: 40px; height: 100%; display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-shrink: 0;">
                        <h1 style="font-size: 48px; margin: 0; text-shadow: 0 4px 10px rgba(0,0,0,0.5);">Big Picture</h1>
                        <button class="btn btn-danger" onclick="toggleBigPicture()" style="font-size: 20px;">Exit Mode</button>
                    </div>
                    
                    <div id="bp-grid">
                        <!-- JS generated grid -->
                    </div>

                    <div id="bp-selection-info">
                        <img id="bp-info-img" src="" style="height: 150px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                        <div style="flex: 1; overflow: hidden;">
                            <h2 id="bp-info-title" style="margin: 0 0 5px 0; font-size: 32px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Game Title</h2>
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 10px;">
                                <span id="bp-info-rating" style="color: gold; font-weight: bold; font-size: 20px;">‚òÖ 0.0</span>
                                <span id="bp-info-meta" style="color: #888; font-size: 16px;">Platform ‚Ä¢ Played: 0h</span>
                            </div>
                            <p id="bp-info-desc" style="margin: 0; color: #aaa; font-size: 14px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"></p>
                        </div>
                        <div style="margin-left: 20px;">
                            <button class="btn btn-primary" id="bp-launch-btn" style="font-size: 24px; padding: 15px 50px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 122, 204, 0.4);">START</button>
                        </div>
                    </div>
                </div>

                <!-- Big Picture Confirmation Modal -->
                <div id="bp-confirm-modal" class="bp-modal-overlay">
                    <div class="bp-modal">
                        <div id="bp-modal-banner"></div>
                        <div class="bp-modal-content">
                            <h1 style="font-size: 42px; margin-bottom: 5px;">Ready to Play?</h1>
                            <p id="bp-confirm-title" style="font-size: 28px; color: gold; margin-bottom: 40px; font-weight: bold;">Cyberpunk 2077</p>
                            <div style="display: flex; gap: 30px; justify-content: center;">
                                <button class="btn btn-primary" id="bp-modal-start" style="font-size: 28px; padding: 20px 80px; border-radius: 15px;">START</button>
                                <button class="btn btn-secondary" onclick="closeBPModal()" style="font-size: 28px; padding: 20px 80px; border-radius: 15px;">BACK</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Library View (Tree) -->
            <div id="view-library" class="view active">
                <div id="library-layout">
                    <!-- Tree Sidebar -->
                    <div id="library-tree-container">
                        <div id="tree-search" style="display: flex; gap: 5px;">
                            <input type="text" id="librarySearch" placeholder="Filter..." onkeyup="filterTree()" style="flex: 1;">
                            <select id="librarySort" onchange="filterTree()" style="width: 80px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--border-radius);">
                                <option value="name">A-Z</option>
                                <option value="time">Time</option>
                                <option value="added">New</option>
                            </select>
                        </div>
                        <div id="library-tree">
                            <!-- JS generates this -->
                        </div>
                    </div>
                    
                    <!-- Main / Details -->
                    <div id="details-panel">
                        <button class="settings-icon-btn" id="detail-settings-btn" title="Game Settings">‚öôÔ∏è</button>
                        <button class="close-btn" onclick="closeDetails()">√ó</button>
                        <div class="hero-image" id="detail-hero"></div>
                        <div class="details-content">
                            <div class="game-title-large" id="detail-title">Select a Game</div>
                            <div class="game-meta" id="detail-meta">Version ‚Ä¢ Playtime</div>
                            
                            <div id="detail-hltb" style="display: flex; gap: 20px; margin-bottom: 20px; color: #aaa; font-size: 13px;">
                                <!-- Populated via JS -->
                            </div>
                            
                            <div class="actions" id="detail-actions">
                                <!-- Dynamic buttons -->
                            </div>

                            <!-- New Metadata Layout -->
                            <div class="detail-grid" style="display: flex; gap: 40px; margin-bottom: 40px;">
                                <!-- Description Column -->
                                <div style="flex: 3;">
                                    <h3 style="margin-top: 0; color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px;">About</h3>
                                    <div id="detail-description" style="color: #ccc; line-height: 1.6; font-size: 15px; max-height: 500px; overflow-y: auto; padding-right: 15px;"></div>
                                    
                                    <div id="detail-requirements" style="margin-top: 20px; display: none;">
                                        <h4 style="color: #fff; margin-bottom: 10px;">System Requirements (PC)</h4>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                            <div id="req-min" style="background: #252526; padding: 15px; border-radius: 6px; font-size: 13px; color: #aaa;"></div>
                                            <div id="req-rec" style="background: #252526; padding: 15px; border-radius: 6px; font-size: 13px; color: #aaa;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Info Side Column -->
                                <div style="flex: 1; min-width: 250px;">
                                    <div class="info-box" style="background: #202020; padding: 20px; border-radius: 8px; border: 1px solid #333;">
                                        
                                        <div style="margin-bottom: 20px;">
                                            <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Rating</div>
                                            <div id="detail-rating" style="font-size: 24px; font-weight: bold; color: var(--accent-color);"></div>
                                        </div>

                                        <div style="margin-bottom: 20px;">
                                            <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Genres</div>
                                            <div id="detail-genres" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                                        </div>

                                        <div style="margin-bottom: 20px;">
                                            <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Developers</div>
                                            <div id="detail-devs" style="color: #ddd; font-size: 14px;"></div>
                                        </div>

                                        <div style="margin-bottom: 20px;">
                                            <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Publishers</div>
                                            <div id="detail-pubs" style="color: #ddd; font-size: 14px;"></div>
                                        </div>

                                        <div>
                                            <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Tags</div>
                                            <div id="detail-tags" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="border-bottom: 1px solid #333; padding-bottom: 10px;">Screenshots</h3>
                            <div class="screenshots" id="detail-gallery"></div>
                        </div>
                    </div>
                    
                    <!-- Empty State / Welcome -->
                    <div id="empty-state" style="flex: 1; display: flex; align-items: center; justify-content: center; color: #444;">
                        <h2>Select a game from the list</h2>
                    </div>
                </div>
            </div>

            <!-- Search View -->
            <div id="view-search" class="view">
                <div class="simple-header"><h1>Store</h1></div>
                <div class="simple-content" id="search-content" style="overflow-y: auto; height: 100%; padding: 0 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; position: sticky; top: 0; background: var(--bg-color); z-index: 100; padding: 20px 0; border-bottom: 1px solid var(--border-color); box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                        <select id="searchCategory" style="padding: 10px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer;">
                            <option value="Games">Games</option>
                            <option value="Movies">Movies</option>
                            <option value="Series">Series</option>
                            <option value="Animes">Animes</option>
                        </select>
                        <input type="text" id="searchInput" placeholder="Search..." style="flex: 1; padding: 10px; border-radius: 4px; border: 1px solid #333; background: #222; color: white;" onkeyup="if(event.key==='Enter') performSearch()">
                        <button class="btn btn-primary" onclick="performSearch()">Search</button>
                    </div>
                    <div id="searchResults" style="display: grid; gap: 10px; padding-top: 20px;"></div>
                </div>

                <!-- Search Preview Overlay -->
                <div id="search-preview-panel" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--bg-color); z-index: 200; overflow-y: auto;">
                    <button class="close-btn" onclick="closeSearchPreview()">√ó</button>
                    <div class="hero-image" id="preview-hero"></div>
                    <div class="details-content">
                        <div class="game-title-large" id="preview-title">Title</div>
                        <div class="game-meta" id="preview-meta">...</div>
                        
                        <div class="actions" id="preview-actions"></div>

                        <div class="detail-grid" style="display: flex; gap: 40px; margin-bottom: 40px;">
                            <div style="flex: 3;">
                                <h3 style="margin-top: 0; color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px;">About</h3>
                                <div id="preview-description" style="color: #ccc; line-height: 1.6; font-size: 15px; max-height: 500px; overflow-y: auto; padding-right: 15px;"></div>
                                <div id="preview-requirements" style="margin-top: 20px; display: none;">
                                    <h4 style="color: #fff; margin-bottom: 10px;">System Requirements (PC)</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                        <div id="preview-req-min" style="background: #252526; padding: 15px; border-radius: 6px; font-size: 13px; color: #aaa;"></div>
                                        <div id="preview-req-rec" style="background: #252526; padding: 15px; border-radius: 6px; font-size: 13px; color: #aaa;"></div>
                                    </div>
                                </div>
                            </div>
                            <div style="flex: 1; min-width: 250px;">
                                <div class="info-box" style="background: #202020; padding: 20px; border-radius: 8px; border: 1px solid #333;">
                                    <div style="margin-bottom: 20px;">
                                        <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Rating</div>
                                        <div id="preview-rating" style="font-size: 24px; font-weight: bold; color: var(--accent-color);"></div>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Genres</div>
                                        <div id="preview-genres" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Developers</div>
                                        <div id="preview-devs" style="color: #ddd; font-size: 14px;"></div>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Publishers</div>
                                        <div id="preview-pubs" style="color: #ddd; font-size: 14px;"></div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Tags</div>
                                        <div id="preview-tags" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h3 style="border-bottom: 1px solid #333; padding-bottom: 10px;">Screenshots</h3>
                        <div class="screenshots" id="preview-gallery"></div>
                    </div>
                </div>
            </div>

            <!-- Downloads View -->
            <div id="view-downloads" class="view">
                <div class="simple-header"><h1>Downloads</h1></div>
                <div class="simple-content">
                    <div id="activeDownload" 
                         ondragover="event.preventDefault()" 
                         ondrop="handleDropToActive(event)">
                        <div class="download-item" style="background: #252526; padding: 20px; border-radius: 8px; border: 1px solid #333;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 5px;">
                                <span id="active-drag-handle" 
                                      draggable="true" 
                                      ondragstart="handleDragActiveStart(event)"
                                      style="color: #666; cursor: grab; font-size: 20px;">‚ò∞</span>
                                <div id="dl-title" class="download-title" style="font-weight: bold; font-size: 16px;">No active download</div>
                            </div>
                            <div id="dl-status-text" style="font-size: 12px; color: #888; margin-bottom: 10px; margin-left: 32px;">Idle</div>
                            
                            <div class="progress-bar" style="background: #161616; height: 12px; border-radius: 6px; overflow: hidden; margin-bottom: 10px; border: 1px solid #333;">
                                <div id="dl-progress-fill" style="background: var(--accent-color); height: 100%; width: 0%; transition: width 0.3s ease-out;"></div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px; color: #aaa;">
                                <div id="dl-size-info">0 Bytes / 0 Bytes</div>
                                <div id="dl-status" style="text-align: right; font-weight: bold; color: white;">0%</div>
                                
                                <div id="dl-speed">0 Bytes/s</div>
                                <div id="dl-remaining" style="text-align: right;">Remaining: --:--:--</div>
                            </div>

                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button id="pause-btn" onclick="togglePause()" class="btn btn-secondary" style="padding: 5px 15px;" disabled>PAUSE</button>
                                <button id="cancel-btn" onclick="stopDownload()" class="btn btn-danger" style="padding: 5px 15px;" disabled>CANCEL</button>
                            </div>
                        </div>
                    </div>
                    <div id="downloadLogs" style="display: none;"></div>
                </div>
            </div>

            <!-- Collections View Removed (Moved to Scripts) -->

            <!-- Scripts View -->
            <div id="view-scripts" class="view">
                <div class="simple-header"><h1>Scripts</h1></div>
                <div class="simple-content" style="display: flex; height: 100%;">
                    <!-- Script List -->
                    <div style="width: 250px; background: #161616; border-right: 1px solid #333; padding: 10px;">
                        <div class="script-item active" onclick="selectScript('universal-downloader')" style="padding: 10px; cursor: pointer; background: #252526; border-radius: 4px; margin-bottom: 5px;">
                            Universal Downloader
                        </div>
                        <div class="script-item" onclick="selectScript('media-converter')" style="padding: 10px; cursor: pointer; background: #252526; border-radius: 4px; margin-bottom: 5px;">
                            Audio Converter
                        </div>
                        <div class="script-item" onclick="selectScript('collections-manager')" style="padding: 10px; cursor: pointer; background: #252526; border-radius: 4px; margin-bottom: 5px;">
                            Collections Manager
                        </div>
                        <div class="script-item" onclick="selectScript('theme-editor')" style="padding: 10px; cursor: pointer; background: #252526; border-radius: 4px; margin-bottom: 5px;">
                            Theme Editor
                        </div>
                    </div>
                    <!-- Script Content -->
                    <div style="flex: 1; padding: 20px; overflow-y: auto;">
                        
                        <!-- Universal Downloader -->
                        <div id="script-universal-downloader" class="script-panel">
                            <h2>Universal Downloader</h2>
                            <p style="color: #aaa; margin-bottom: 20px;">
                                Download from supported providers using the internal Download Manager logic.
                            </p>
                            <div class="form-group">
                                <label>Target URL</label>
                                <div class="input-row">
                                    <input type="text" id="script-url-input" placeholder="https://example.com/item...">
                                    <button class="btn btn-primary" onclick="runUniversalDownloader()">Run Script</button>
                                </div>
                                <p class="hint">The download will be added to the Downloads queue.</p>
                            </div>
                        </div>

                        <!-- Theme Editor -->
                        <div id="script-theme-editor" class="script-panel" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="margin: 0;">üé® Theme Editor</h2>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-secondary" onclick="importTheme()">Import JSON</button>
                                    <button class="btn btn-secondary" onclick="exportTheme()">Export JSON</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Theme Name</label>
                                <div class="input-row">
                                    <input type="text" id="theme-name" placeholder="My Custom Theme">
                                    <button class="btn btn-primary" onclick="saveCustomTheme()">Save & Apply</button>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                                <div class="form-group">
                                    <label>Background Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-bg" value="#121212" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-bg-text" value="#121212" onchange="document.getElementById('theme-bg').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Sidebar Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-sidebar" value="#1e1e1e" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-sidebar-text" value="#1e1e1e" onchange="document.getElementById('theme-sidebar').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Accent Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-accent" value="#007acc" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-accent-text" value="#007acc" onchange="document.getElementById('theme-accent').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Card Background</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-card" value="#1e1e1e" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-card-text" value="#1e1e1e" onchange="document.getElementById('theme-card').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Input Background</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-input" value="#161616" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-input-text" value="#161616" onchange="document.getElementById('theme-input').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Text Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-text" value="#e0e0e0" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-text-text" value="#e0e0e0" onchange="document.getElementById('theme-text').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Border Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-border" value="#333333" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-border-text" value="#333333" onchange="document.getElementById('theme-border').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Hover Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-hover" value="#2d2d30" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-hover-text" value="#2d2d30" onchange="document.getElementById('theme-hover').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Dimmed Text Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-text-dim" value="#888888" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-text-dim-text" value="#888888" onchange="document.getElementById('theme-text-dim').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Shadow Color (RGBA)</label>
                                    <div class="input-row">
                                        <input type="text" id="theme-shadow" value="rgba(0,0,0,0.5)">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Border Radius</label>
                                    <div class="input-row">
                                        <input type="text" id="theme-radius" value="6px">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Font Family</label>
                                    <div class="input-row">
                                        <input type="text" id="theme-font" value="'Segoe UI', system-ui, sans-serif">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Transition Speed</label>
                                    <div class="input-row">
                                        <input type="text" id="theme-speed" value="0.2s">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Danger Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-danger" value="#ff6b6b" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-danger-text" value="#ff6b6b" onchange="document.getElementById('theme-danger').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Danger Border</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-danger-border" value="#5a2a2a" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-danger-border-text" value="#5a2a2a" onchange="document.getElementById('theme-danger-border').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Header Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-header" value="#ffffff" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-header-text" value="#ffffff" onchange="document.getElementById('theme-header').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Success Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-success" value="#28a745" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-success-text" value="#28a745" onchange="document.getElementById('theme-success').value = this.value">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Warning Color</label>
                                    <div class="input-row">
                                        <input type="color" id="theme-warning" value="#ffc107" style="padding: 0; height: 40px; width: 60px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                                        <input type="text" id="theme-warning-text" value="#ffc107" onchange="document.getElementById('theme-warning').value = this.value">
                                    </div>
                                </div>
                            </div>
                            <p class="hint">Changes are applied immediately. Save to create a new persistent theme.</p>
                        </div>

                        <!-- Audio Converter -->
                        <div id="script-media-converter" class="script-panel" style="display: none;">
                            <h2>Audio Converter</h2>
                            <p style="color: #aaa; margin-bottom: 20px;">
                                Convert audio, video, or images using FFmpeg.
                            </p>
                            <div class="form-group" 
                                 ondragover="event.preventDefault(); this.style.borderColor='var(--accent-color)'" 
                                 ondragleave="this.style.borderColor='#333'" 
                                 ondrop="handleConverterDrop(event)"
                                 style="border: 2px dashed #333; padding: 20px; border-radius: 8px; text-align: center; transition: border-color 0.2s;">
                                <label>Input File (Drag & Drop here)</label>
                                <div class="input-row">
                                    <input type="text" id="convert-input-path" placeholder="C:\Path\To\File.wav">
                                    <button class="btn btn-secondary" onclick="selectFileForConvert()">Browse</button>
                                </div>
                            </div>
                            <div class="form-group" id="convert-output-group" style="display: none; margin-top: 20px; animation: fadeIn 0.3s;">
                                <label>Output Format</label>
                                <select id="convert-format" style="width: 100%; padding: 10px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--border-radius);">
                                    <!-- Options populated dynamically -->
                                </select>
                                <button class="btn btn-primary" onclick="runMediaConvert()" style="width: 100%; margin-top: 15px;">Convert Now</button>
                            </div>
                        </div>

                        <!-- Collections Manager -->
                        <div id="script-collections-manager" class="script-panel" style="display: none; height: 100%;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="margin: 0;">Collections Manager</h2>
                                <button class="btn btn-primary" onclick="createCollectionPrompt()">+ New List</button>
                            </div>
                            
                            <div style="display: flex; height: calc(100% - 60px); gap: 20px;">
                                <!-- Collection List (Sidebar) -->
                                <div style="width: 250px; display: flex; flex-direction: column; gap: 10px; border-right: 1px solid var(--border-color); padding-right: 20px; overflow-y: auto;">
                                    <div id="collections-list">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                                
                                <!-- Collection Details (Main) -->
                                <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                                    <div id="collection-detail-header" style="display: none; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                                        <h2 id="active-collection-name" style="margin: 0; font-size: 20px;">Select a List</h2>
                                        <div style="display: flex; gap: 10px;">
                                            <button class="btn btn-secondary" onclick="renameCollectionPrompt()">Rename</button>
                                            <button class="btn btn-danger" onclick="deleteCollectionPrompt()">Delete</button>
                                        </div>
                                    </div>

                                    <div id="collection-items-container" style="display: none; flex-direction: column; flex: 1; overflow-y: auto;">
                                        <!-- Add Item Input -->
                                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                            <input type="text" id="new-item-input" placeholder="Add new item (e.g. One Piece)..." style="flex: 1; padding: 10px; background: var(--input-bg); border: 1px solid var(--border-color); color: white; border-radius: 4px;" onkeyup="if(event.key==='Enter') addItemToCollection()">
                                            <button class="btn btn-primary" onclick="addItemToCollection()">Add</button>
                                        </div>
                                        
                                        <!-- Items List -->
                                        <div id="collection-items-list" style="display: flex; flex-direction: column; gap: 8px;">
                                            <!-- Populated by JS -->
                                        </div>
                                    </div>

                                    <div id="collection-empty-state" style="display: flex; flex: 1; align-items: center; justify-content: center; color: #666; font-style: italic;">
                                        Select or create a collection to get started.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile View -->
            <div id="view-profile" class="view" style="flex-direction: column; height: 100%;">
                <div class="simple-header"><h1>Profile</h1></div>
                <div class="simple-content">
                    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                        <div class="info-box" style="flex: 1; background: var(--card-bg); padding: 20px; border-radius: var(--border-radius); text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 36px; color: var(--accent-color);" id="profile-playtime">0h</div>
                            <div style="color: var(--text-dim);">Total Playtime</div>
                        </div>
                        <div class="info-box" style="flex: 1; background: var(--card-bg); padding: 20px; border-radius: var(--border-radius); text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 36px; color: var(--accent-color);" id="profile-count">0</div>
                            <div style="color: var(--text-dim);">Games in Library</div>
                        </div>
                    </div>
                    
                    <h3>Favorite Genres</h3>
                    <div id="profile-genres" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px;">
                        <!-- Badges -->
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view" style="flex-direction: column; height: 100%;">
                <div class="simple-header" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                    <h1>Settings</h1>
                    <button class="btn btn-primary" onclick="saveSettings()" style="font-size: 16px; padding: 10px 25px;">üíæ Save All Settings</button>
                </div>
                <div class="simple-content settings-wrapper" style="flex: 1; overflow-y: auto; overflow-x: hidden;">
                    
                    <!-- User Profile -->
                    <div class="settings-card">
                        <h2 data-i18n="settings.profile">üë§ User Profile</h2>
                        <div class="form-group">
                            <label data-i18n="settings.username">Username</label>
                            <div class="input-row">
                                <input type="text" id="usernameInput" placeholder="Enter your username">
                            </div>
                            <p class="hint" data-i18n="settings.username_hint">Displayed in the sidebar and used for personalization.</p>
                        </div>
                        <div class="form-group">
                            <label data-i18n="settings.language">Language</label>
                            <select id="languageInput" style="width: 100%; padding: 12px 15px; background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-color); border-radius: var(--border-radius); font-family: inherit; font-size: 14px; cursor: pointer;">
                                <option value="en">English</option>
                                <option value="de">Deutsch (German)</option>
                                <option value="fr">Fran√ßais (French)</option>
                                <option value="es">Espa√±ol (Spanish)</option>
                                <option value="it">Italiano (Italian)</option>
                                <option value="pt">Portugu√™s (Portuguese)</option>
                                <option value="nl">Nederlands (Dutch)</option>
                                <option value="pl">Polski (Polish)</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π (Russian)</option>
                                <option value="tr">T√ºrk√ße (Turkish)</option>
                                <option value="sv">Svenska (Swedish)</option>
                                <option value="da">Dansk (Danish)</option>
                                <option value="no">Norsk (Norwegian)</option>
                                <option value="fi">Suomi (Finnish)</option>
                                <option value="cs">ƒåe≈°tina (Czech)</option>
                                <option value="hu">Magyar (Hungarian)</option>
                                <option value="ro">Rom√¢nƒÉ (Romanian)</option>
                                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (Ukrainian)</option>
                                <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨ (Greek)</option>
                                <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá (Chinese Simplified)</option>
                                <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥ (Korean)</option>
                                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
                                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                                <option value="pt-br">Portugu√™s (Brasil)</option>
                                <option value="id">Bahasa Indonesia (Indonesian)</option>
                                <option value="th">‡πÑ‡∏ó‡∏¢ (Thai)</option>
                                <option value="vi">Ti·∫øng Vi·ªát (Vietnamese)</option>
                            </select>
                            <p class="hint" data-i18n="settings.language_hint">Select your preferred language.</p>
                        </div>
                        <div class="form-group">
                            <label data-i18n="settings.theme">Theme</label>
                            <select id="themeInput" style="width: 100%; padding: 12px 15px; background-color: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-color); border-radius: var(--border-radius); font-family: inherit; font-size: 14px; cursor: pointer;">
                                <option value="dark">Dark (Default)</option>
                                <option value="light">Light</option>
                                <option value="oled">OLED (True Black)</option>
                                <option value="cyberpunk">Cyberpunk</option>
                                <option value="neon_city">Neon City</option>
                                <option value="dracula">Dracula</option>
                                <option value="midnight">Midnight</option>
                                <option value="forest">Forest</option>
                                <option value="ocean">Ocean</option>
                                <option value="sunset">Sunset</option>
                                <option value="high_contrast">High Contrast</option>
                                <option value="retro">Retro</option>
                                <option value="coffee">Coffee</option>
                                <option value="nord">Nord</option>
                            </select>
                            <p class="hint" data-i18n="settings.theme_hint">Select your preferred visual style.</p>
                        </div>
                    </div>

                    <!-- Integrations -->
                    <div class="settings-card">
                        <h2 data-i18n="settings.integrations">üîå Integrations</h2>
                        <div class="form-group">
                            <label>RAWG API Key</label>
                            <div class="input-row">
                                <input type="password" id="rawgKeyInput" placeholder="Enter your RAWG API Key">
                                <button class="btn btn-secondary" onclick="togglePasswordVisibility('rawgKeyInput')" style="padding: 0 15px;">üëÅÔ∏è</button>
                            </div>
                            <p class="hint">
                                Required for fetching game covers, screenshots, and metadata. 
                                <a href="https://rawg.io/apidocs" target="_blank" style="color: var(--accent-color); text-decoration: none;">Get a free key here</a>.
                            </p>
                        </div>
                        <div class="form-group">
                            <label>Real-Debrid API Key</label>
                            <div class="input-row">
                                <input type="password" id="debridKeyInput" placeholder="Enter your Real-Debrid API Key">
                                <button class="btn btn-secondary" onclick="togglePasswordVisibility('debridKeyInput')" style="padding: 0 15px;">üëÅÔ∏è</button>
                            </div>
                            <p class="hint">Unlocks premium download speeds for supported hosts.</p>
                        </div>
                    </div>

                    <!-- Source Configuration -->
                    <div class="settings-card">
                        <h2><i class="fas fa-cog"></i> Source Configuration</h2>
                        <div class="form-group">
                            <label>Source 1 URL</label>
                            <div class="input-row">
                                <input type="text" id="source-1-url-input" placeholder="https://example.com/source1">
                            </div>
                            <p class="hint">Primary content and metadata source.</p>
                        </div>
                        <div class="form-group">
                            <label>Source 2 URL</label>
                            <div class="input-row">
                                <input type="text" id="source-2-url-input" placeholder="https://example.com/source2">
                            </div>
                            <p class="hint">Secondary media source.</p>
                        </div>
                        <button id="save-sources-btn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-save"></i> Save Source URLs
                        </button>
                    </div>

                    <!-- Tools Management -->
                    <div class="settings-card">
                        <h2>üõ†Ô∏è Tools & Dependencies</h2>
                        <div id="tools-status-list" class="path-list">
                            <!-- Populated by JS -->
                        </div>
                        <p class="hint">These tools are required for advanced features like media conversion and compression.</p>
                    </div>

                    <!-- Windows Sandbox -->
                    <div id="sandbox-card" class="settings-card" style="display: none;">
                        <h2>üõ°Ô∏è Windows Sandbox</h2>
                        <div id="sandbox-status-content">
                            <!-- Populated by JS -->
                        </div>
                        <p class="hint">Windows Sandbox provides a lightweight desktop environment to safely run applications in isolation. (Requires Windows 11 Pro)</p>
                    </div>

                    <!-- Library Locations -->
                    <div class="settings-card">
                        <h2>üìö Game Library Locations</h2>
                        <div class="form-group">
                            <label>Managed Folders</label>
                            <ul id="gamePathsList" class="path-list">
                                <!-- Populated by JS -->
                            </ul>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="addGamePath()">+ Add Folder</button>
                                <button class="btn btn-secondary" onclick="forceUpdateConfig()">Force Update Configurations</button>
                                <button class="btn btn-primary" onclick="fetch(`${API_URL}/api/library/check_updates`).then(() => showToast('Update check started', 'info'))">Check Web Updates</button>
                            </div>
                            <p class="hint">SyntaxRipper scans these folders for installed games. Force Update re-scans all executables.</p>
                        </div>
                    </div>

                    <!-- Downloads -->
                    <div class="settings-card">
                        <h2>‚¨áÔ∏è Downloads</h2>
                        <div class="form-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <label style="margin-bottom: 0;">Resume on Startup</label>
                                <label class="switch">
                                    <input type="checkbox" id="resumeStartupInput">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <p class="hint">Automatically resume pending downloads when the application starts.</p>
                        </div>
                        <div class="form-group">
                            <label>Default Download Path</label>
                            <div class="input-row">
                                <input type="text" id="downloadPathInput" readonly>
                                <button class="btn btn-secondary" onclick="openPath(document.getElementById('downloadPathInput').value)">üìÇ</button>
                                <button class="btn btn-secondary" onclick="changeDownloadPath()">Change</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Default Installation Path</label>
                            <div class="input-row">
                                <input type="text" id="installedGamesPathInput" readonly>
                                <button class="btn btn-secondary" onclick="openPath(document.getElementById('installedGamesPathInput').value)">üìÇ</button>
                                <button class="btn btn-secondary" onclick="changeInstalledGamesPath()">Change</button>
                            </div>
                            <p class="hint">Where games downloaded via the launcher will be installed.</p>
                        </div>
                        <div class="form-group">
                            <label>Download Cache Path</label>
                            <div class="input-row">
                                <input type="text" id="downloadCachePathInput" readonly>
                                <button class="btn btn-secondary" onclick="openPath(document.getElementById('downloadCachePathInput').value)">üìÇ</button>
                                <button class="btn btn-secondary" onclick="changeDownloadCachePath()">Change</button>
                            </div>
                            <p class="hint">Temporary location for active downloads and archives before unpacking.</p>
                        </div>
                        <div class="form-group">
                            <label>Media Output Path</label>
                            <div class="input-row">
                                <input type="text" id="mediaOutputPathInput" readonly>
                                <button class="btn btn-secondary" onclick="openPath(document.getElementById('mediaOutputPathInput').value)">üìÇ</button>
                                <button class="btn btn-secondary" onclick="changeMediaOutputPath()">Change</button>
                            </div>
                            <p class="hint">Location for converted media files.</p>
                        </div>
                        <div class="form-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <label style="margin-bottom: 0;">Download Speed Limit (KB/s)</label>
                                <label class="switch">
                                    <input type="checkbox" id="speedLimitEnabledInput">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="input-row">
                                <input type="number" id="speedLimitInput" min="0" placeholder="e.g. 5000 for 5MB/s">
                            </div>
                            <p class="hint">Enable to restrict download bandwidth. Limit applies when the switch is ON.</p>
                        </div>
                        <div class="form-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <label style="margin-bottom: 0;">Enable Auto-updates Games</label>
                                <label class="switch">
                                    <input type="checkbox" id="autoUpdateInput">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <p class="hint">Automatically check for and download new versions of installed games (if supported).</p>
                        </div>
                    </div>

                    <!-- Behavior -->
                    <div class="settings-card">
                        <h2>‚öôÔ∏è Behavior</h2>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;" title="If enabled, games will launch without Save Detection (Procmon). Keeps only playtime tracking.">Dry Launch Mode ‚ìò</label>
                                <p class="hint" style="margin-top: 5px;">Skips background save path detection. Keeps only playtime tracking.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="dryLaunchInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">Verbose Logging</label>
                                <p class="hint" style="margin-top: 5px;">Enable detailed logs for debugging purposes.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="verboseLoggingInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">Controller Support</label>
                                <p class="hint" style="margin-top: 5px;">Enable navigation using a gamepad or arrow keys.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="controllerSupportInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">Show Hidden Games</label>
                                <p class="hint" style="margin-top: 5px;">Reveal games that have been hidden from the library.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="showHiddenInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">Random Game: Include Uninstalled</label>
                                <p class="hint" style="margin-top: 5px;">If enabled, the random game picker will include games that are not currently installed.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="randomUninstalledInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">Discord Rich Presence</label>
                                <p class="hint" style="margin-top: 5px;">Show what you are playing on your Discord profile.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="discordRpcInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <label style="margin-bottom: 0;">System Gaming Mode</label>
                                <p class="hint" style="margin-top: 5px;">Automatically optimize power plan and process priority when launching a game.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="gamingModeInput">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                    <!-- System -->
                    <div class="settings-card" style="border-color: #5a2a2a;">
                        <h2 style="color: var(--danger-color);">‚ö†Ô∏è System</h2>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                            <span style="color: #aaa;">Clear all downloaded images and metadata.</span>
                            <button class="btn btn-secondary" onclick="cleanCache()">Clean Metadata Cache</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                            <span style="color: #aaa;">Clear all temporary download files and partial archives.</span>
                            <button class="btn btn-secondary" onclick="cleanDownloadCache()">Clean Download Cache</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                            <span style="color: #aaa;">Open the application log folder for debugging.</span>
                            <button class="btn btn-secondary" onclick="openLogDir()">Open Log Folder</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                            <span style="color: #aaa;">Remove known orphaned save data folders.</span>
                            <button class="btn btn-secondary" onclick="openCleanSavesDialog()">Clean Unused Save Data</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                            <span style="color: #aaa;">Exclude all game folders from Windows Defender to prevent missing files.</span>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="fixMissingFiles()">Fix Missing Game Files</button>
                                <button class="btn btn-secondary" id="btn-revert-defender" onclick="revertDefenderFix()" style="display:none; color: var(--danger-color); border-color: var(--danger-border);">Revert Exclusions</button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #aaa;">Restart the application to apply deep configuration changes.</span>
                            <button class="btn btn-danger" onclick="ipcRenderer.send('restart_app')">Restart Application</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="footer">
            <span id="footerStatus" style="display: flex; align-items: center;"><span class="spin">‚Üª</span> Connecting...</span>
            <span>V3.13.0</span>
        </div>
    </div>

    <div id="fullscreen-overlay" onclick="closeFullscreen()">
        <div class="fullscreen-arrow" style="left: 20px;" onclick="event.stopPropagation(); changeSlide(-1); updateFullscreenImg();">‚ùÆ</div>
        <div class="fullscreen-arrow" style="right: 20px;" onclick="event.stopPropagation(); changeSlide(1); updateFullscreenImg();">‚ùØ</div>
        <img id="fullscreen-img" src="">
        <div id="fullscreen-count" style="position:absolute; bottom:20px; color:white; font-size:18px; font-weight:bold; text-shadow:0 2px 8px rgba(0,0,0,0.9); z-index:2100;"></div>
    </div>

    <style>
        /* Fullscreen Overlay */
        #fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.2s ease-out;
        }

        .fullscreen-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 60px;
            cursor: pointer;
            padding: 20px;
            user-select: none;
            transition: color 0.2s, transform 0.2s;
            z-index: 2100;
            text-shadow: 0 0 20px rgba(0,0,0,1);
        }

        .fullscreen-arrow:hover {
            color: var(--accent-color);
            transform: translateY(-50%) scale(1.2);
        }
        
        #fullscreen-img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform: scale(0.9);
            animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes zoomIn {
            to { transform: scale(1); }
        }
    </style>

    <div id="context-menu" class="context-menu"></div>

    <!-- Custom Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-card">
            <h2 id="modal-title">Notification</h2>
            <p id="modal-body">Message goes here...</p>
            <div id="modal-footer" class="modal-footer">
                <!-- Buttons injected by JS -->
            </div>
        </div>
    </div>

    <!-- Clean Saves Modal -->
    <div id="clean-saves-modal" class="modal-overlay">
        <div class="modal-card" style="max-width: 600px;">
            <h2>Clean Unused Save Data</h2>
            <div class="modal-body-scroll">
                <p style="padding: 0 0 20px 0;">Select the orphaned save folders you wish to delete from your system.</p>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="toggleSaveSelection(true)">Select All</button>
                    <button class="btn btn-secondary" onclick="toggleSaveSelection(false)">Deselect All</button>
                </div>

                <div id="orphaned-saves-list" class="path-list" style="max-height: none;">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeCleanSavesDialog()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="deleteSelectedSaves()">Delete Selected</button>
            </div>
        </div>
    </div>

    <!-- Game Settings Modal -->
    <div id="game-settings-modal" class="modal-overlay">
        <div class="modal-card">
            <h2 id="gs-title">Game Settings</h2>
            
            <div class="modal-body-scroll">
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Game Alias</label>
                        <input type="text" id="gs-alias" style="width: 100%; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box;">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Executable Path</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="gs-exe" style="flex: 1; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box;">
                            <button class="btn btn-secondary" onclick="selectGameExe()" style="padding: 0 15px;">üìÅ</button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Launch Arguments (one per line)</label>
                        <textarea id="gs-args" style="width: 100%; height: 60px; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Save Data Path</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="gs-save-path" style="flex: 1; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box;">
                            <select id="gs-save-candidates" style="display:none; max-width: 150px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--border-radius);" onchange="document.getElementById('gs-save-path').value = this.value">
                                <option value="">Detected...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Tags (comma separated)</label>
                        <input type="text" id="gs-tags" placeholder="RPG, Open World, Co-op..." style="width: 100%; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box;">
                    </div>

                    <div style="display: flex; gap: 10px; border-top: 1px solid #333; padding-top: 15px; margin-top: 10px;">
                        <div style="flex: 1;">
                            <label style="display:block; margin-bottom:5px; font-size:12px; color:#aaa;">Pre-Launch Script (Batch)</label>
                            <textarea id="gs-pre-script" style="width: 100%; height: 60px; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                        <div style="flex: 1;">
                            <label style="display:block; margin-bottom:5px; font-size:12px; color:#aaa;">Post-Exit Script (Batch)</label>
                            <textarea id="gs-post-script" style="width: 100%; height: 60px; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                    </div>

                    <div id="gs-backups-section" style="border-top: 1px solid #333; padding-top: 15px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <label style="margin:0;">Save Backups</label>
                            <button class="btn btn-secondary" onclick="triggerManualBackup()" style="padding: 2px 10px; font-size: 12px;">Create New</button>
                        </div>
                        <ul id="gs-backup-list" class="path-list" style="max-height: 100px; margin-bottom: 0;"></ul>
                    </div>

                    <div id="gs-metadata-section" style="border-top: 1px solid #333; padding-top: 15px; margin-top: 10px;">
                        <label style="margin-bottom: 10px; display: block;">Fix Metadata</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="gs-metadata-query" placeholder="Enter original game name..." style="flex: 1; padding: 10px; background: #161616; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box;">
                            <button class="btn btn-primary" onclick="refetchMetadata()" style="padding: 0 15px;">Fetch</button>
                        </div>
                        <p class="hint">If metadata is incorrect, enter the exact game name here to re-fetch.</p>
                    </div>

                    <div id="gs-maintenance-section" style="border-top: 1px solid #333; padding-top: 15px; margin-top: 10px;">
                        <label style="margin-bottom: 10px; display: block;">Maintenance Tools</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn btn-secondary" onclick="runIntegrityCheck()">üõ°Ô∏è Check Integrity</button>
                            <button class="btn btn-secondary" onclick="runJunkClean()">üßπ Clean Junk</button>
                            <button class="btn btn-secondary" onclick="openFolder(currentSettingsGameId)">üìÇ Open Folder</button>
                            <button class="btn btn-secondary" onclick="detectSavesInSandbox()">üîç Detect Saves (Sandbox)</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeGameSettings()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="saveGameSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <style>
        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            z-index: 5000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease-out;
        }
        .modal-card {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 0; /* Remove global padding */
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9);
            animation: modalZoom 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            overflow: hidden;
        }
        @keyframes modalZoom { to { transform: scale(1); } }
        .modal-card h2 { 
            margin: 0; 
            color: white; 
            font-size: 20px; 
            border-bottom: 1px solid #333; 
            padding: 25px 30px; 
            flex-shrink: 0; 
            background: #1e1e1e;
        }
        .modal-card p { color: #ccc; line-height: 1.6; font-size: 15px; margin: 0; padding: 0 30px 20px 30px; }
        .modal-footer { 
            display: flex; 
            justify-content: flex-end; 
            gap: 12px; 
            flex-shrink: 0; 
            padding: 20px 30px; 
            background: #1a1a1a; 
            border-top: 1px solid #333;
        }
        
        .modal-body-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 20px 30px;
        }
        
        .modal-btn {
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            border: none;
        }
        .modal-btn-primary { background: var(--accent-color); color: white; }
        .modal-btn-primary:hover { background: #0063a8; }
        .modal-btn-secondary { background: #333; color: #eee; }
        .modal-btn-secondary:hover { background: #444; }
        .modal-btn-danger { background: transparent; color: var(--danger-color); border: 1px solid var(--danger-border); }
        .modal-btn-danger:hover { background: var(--hover-color); border-color: var(--danger-color); }

        /* ... existing styles ... */
        
        /* Context Menu */
        .context-menu {
            display: none;
            position: absolute;
            background: #252526;
            border: 1px solid #454545;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-radius: 4px;
            z-index: 9999;
            min-width: 180px;
            padding: 5px 0;
        }
        .context-item {
            padding: 8px 15px;
            cursor: pointer;
            color: #eee;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            outline: none; /* Handled by global :focus */
        }
        .context-item:focus, .context-item:hover {
            background-color: #37373d; /* VSCode style hover */
            color: white;
        }
        .context-separator {
            height: 1px;
            background-color: #454545;
            margin: 5px 0;
        }
        .submenu {
            display: none;
            position: absolute;
            left: 100%;
            top: -5px; /* Slight offset */
            background: #252526;
            border: 1px solid #454545;
            min-width: 150px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-radius: 4px;
            padding: 5px 0;
        }
        .context-item:hover > .submenu {
            display: block;
        }
        /* Arrow for submenu */
        .context-item.has-submenu::after {
            content: '‚ñ∂';
            font-size: 10px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            background: #161616;
            border: 1px solid #333;
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            margin-bottom: 15px;
            outline: none;
        }
        .modal-input:focus {
            border-color: var(--accent-color);
        }

        /* Loading & Status Animations */
        .status-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }
        .status-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .status-check {
            color: #28a745;
            font-size: 18px;
            animation: fadeIn 0.3s ease forwards;
        }
        .status-error {
            color: #ff6b6b;
            font-size: 18px;
            animation: fadeIn 0.3s ease forwards;
        }
        .btn-loading {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
            color: transparent !important;
        }
        .btn-loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -10px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
        }
    </style>

    <!-- Setup Wizard Modal -->
    <div id="setup-modal-overlay" class="modal-overlay" style="display: none; z-index: 999999; background: #000; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: all;">
        <div class="modal-card" style="max-width: 500px; border: 2px solid var(--accent-color); box-shadow: 0 0 50px rgba(0, 122, 204, 0.5); background: #0a0a0a;">
            <h2 style="background: #111; color: var(--accent-color); border-bottom: 1px solid #222;"><i class="fas fa-lock"></i> System Locked</h2>
            <div class="modal-body-scroll" style="background: #0a0a0a; padding: 30px;">
                <p style="color: #fff; font-size: 15px; margin-bottom: 25px; line-height: 1.5;">Framework initialization required. Please enter your provider URLs to unlock the system.</p>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 11px; color: var(--accent-color); text-transform: uppercase; font-weight: bold;">Source 1: Primary Content</label>
                    <input type="text" id="setup-source-1" class="modal-input" placeholder="e.g. steamrip.com" style="background: #111; border-color: #333;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 11px; color: var(--accent-color); text-transform: uppercase; font-weight: bold;">Source 2: Secondary Media</label>
                    <input type="text" id="setup-source-2" class="modal-input" placeholder="e.g. filmpalast.to" style="background: #111; border-color: #333;">
                </div>
                
                <div id="setup-status-container" class="status-indicator" style="background: #111; padding: 15px; border-radius: 8px; border: 1px solid #222; margin-top: 10px;">
                    <div id="setup-status-icon" class="status-spinner"></div>
                    <span id="setup-status-text" style="color: #eee; font-family: monospace; font-size: 12px;">Waiting for input...</span>
                </div>
            </div>
            <div class="modal-footer" style="background: #0a0a0a; border-top: 1px solid #222; padding: 20px 30px;">
                <button id="setup-activate-btn" class="modal-btn modal-btn-primary" onclick="runInitialSetup()" style="width: 100%; padding: 15px; font-size: 14px; letter-spacing: 1px; font-weight: 800;">INITIALIZE FRAMEWORK</button>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>